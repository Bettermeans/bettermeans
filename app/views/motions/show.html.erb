<h3>Motion: <%=h @motion.title %></h3>

<h2><%=h @topic.subject %></h2>

<div class="message">  
  
<p><span class="author"><%= authoring @topic.created_on, @topic.author %></span></p>
  
  
<div class="wiki">
<%= textilizable(@topic.content, :attachments => @topic.attachments) %>
</div>

<p>
  <b>Variation:</b>
  <%=h @motion.variation %>
</p>
<p>
  <b>Vote Type</b>
  <%=l "lable_motion_vote_type#{@motion.motion_type}" %>
</p>
<p>
  <b>State</b>
  <%=l "label_motion_state#{@motion.state}" %>
</p>
</div>
<br />

<% unless @replies.empty? %>
<h3 class="comments"><%= l(:label_reply_plural) %></h3>
<% @replies.each do |message| %>
  <div class="message reply" id="<%= "message-#{message.id}" %>">
    <div class="contextual">
      <%= link_to_remote_if_authorized image_tag('comment.png'), { :url => {:action => 'quote', :id => message} }, :title => l(:button_quote) %>
      <%= link_to(image_tag('edit.png'), {:action => 'edit', :id => message}, :title => l(:button_edit)) if message.editable_by?(User.current) %>
      <%= link_to(image_tag('delete.png'), {:action => 'destroy', :id => message}, :method => :post, :confirm => l(:text_are_you_sure), :title => l(:button_delete)) if message.destroyable_by?(User.current) %>
    </div>
    <!-- <div class="replyvote" id="votes_<%#= message.id %>"><%#= render :partial => "votes/reply_vote", :locals => {:reply => message} %></div>             -->
    
  <h4>
    <%= link_to h(message.subject), { :controller => 'messages', :action => 'show', :board_id => @board, :id => @topic, :anchor => "message-#{message.id}" } %>
    -
    <%= authoring message.created_on, message.author %>
  </h4>
  <div class="wiki"><%= textilizable message, :content, :attachments => message.attachments %></div>
  <%= link_to_attachments message, :author => false %>
  </div>
<% end %>
<% end %>

<% if !@topic.locked? && authorize_for('messages', 'reply') %>
<p><%= toggle_link l(:button_reply), "reply", :focus => 'message_content' %></p>
<div id="reply" style="display:none;">
<% form_for :reply, @reply, :url => {:action => 'reply', :id => @topic}, :html => {:multipart => true, :id => 'message-form'} do |f| %>
  <%= render :partial => 'messages/form', :locals => {:f => f, :replying => true} %>
  <%= submit_tag l(:button_submit) %>
  <%= link_to_remote l(:label_preview), 
                     { :url => { :controller => 'messages', :action => 'preview', :board_id => @board },
                       :method => 'post',
                       :update => 'preview',
                       :with => "Form.serialize('message-form')",
                       :complete => "$('body').scrollTo('#preview')"
                     }, :accesskey => accesskey(:preview) %>
<% end %>
<div id="preview" class="wiki"></div>
</div>
<% end %>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'scm' %>
<% end %>

<% html_title h(@topic.subject) %>


<%#= render :partial => "messages/motion_topic", :locals => {:topic => @motion.topic} %>

<% content_for :sidebar do %>
<h3>Voting</h3>
<%#= render :partial => "_votes" %>
<% end %>
